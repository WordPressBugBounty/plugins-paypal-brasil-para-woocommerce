/*! For license information please see frontend-bcdc.js.LICENSE.txt */
(()=>{"use strict";var e={"./src/frontend/frontend-bcdc/frontend-bcdc-api.ts":(e,t,a)=>{a.r(t),a.d(t,{paymentBCDC:()=>n});var r=a("./src/frontend/frontend-shared.ts");const n={create:e=>{if(e.errors)throw new Error(e.errors);if(e.payment_id)return e.payment_id;throw new Error("An error occurred in the CREATE_ORDER")},approve:e=>{jQuery("#paypal-bcdc-fields [name=paypal-brasil-bcdc-order-id]").val(e.orderID),jQuery("#paypal-bcdc-fields [name=paypal-brasil-bcdc-payer-id]").val(e.payerID),jQuery("#paypal-bcdc-fields [name=paypal-brasil-bcdc-pay-id]").val(e.paymentID),r.PaypalPayments.submitForm()},error:e=>{const t=jQuery("#wc-bcdc-brasil-api-error-data").val();if(t)r.PaypalPayments.setNotices(JSON.parse(t)),r.PaypalPayments.scrollTop();else{var a='<ul class="woocommerce-error" role="alert"><li>'+e.message+"</li></ul>";r.PaypalPayments.setNotices(a),r.PaypalPayments.scrollTop()}},cancel:()=>{r.PaypalPayments.triggerUpdateCheckout(),r.PaypalPayments.setNotices(paypal_brasil_bcdc_messages.cancel_message),r.PaypalPayments.scrollTop()}}},"./src/frontend/frontend-sdk/frontend-sdk-bcdc.ts":(e,t,a)=>{a.r(t),a.d(t,{importBcdcSdk:()=>n});var r=function(e,t,a,r){return new(a||(a=Promise))((function(n,o){function c(e){try{i(r.next(e))}catch(e){o(e)}}function l(e){try{i(r.throw(e))}catch(e){o(e)}}function i(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(c,l)}i((r=r.apply(e,t||[])).next())}))};const n={handle(){return r(this,void 0,void 0,(function*(){const e=paypal_brasil_bcdc_settings.client_id,t=paypal_brasil_bcdc_settings.currency,a=paypal_brasil_bcdc_settings.locale,r=document.getElementById("paypal-sdk-script"),n=`https://www.paypal.com/sdk/js?client-id=${e}&components=buttons,funding-eligibility,marks,marks&currency=${t}&locale=${a}`;if(r&&r.getAttribute("src")!==n||!r){const e=document.createElement("script");return e.id="paypal-sdk-script",e.async=!0,e.src=n,e.setAttribute("data-page-type","checkout"),document.head.appendChild(e),new Promise(((t,a)=>{e.onload=()=>{t()},e.onerror=e=>{console.error("Erro ao carregar o script do PayPal:",e),t()}}))}return Promise.resolve()}))}}},"./src/frontend/frontend-shared.ts":(e,t,a)=>{a.r(t),a.d(t,{PaypalPayments:()=>r});class r{static scrollTop(){jQuery("html, body").animate({scrollTop:0},300)}static setNotices(e){jQuery(".woocommerce-notices-wrapper:first").html(e)}static makeRequest(e,t){console.log(e);const a={async:!0,crossDomain:!0,url:r.replaceVars(paypal_brasil_settings.paypal_brasil_handler_url,{ACTION:e}),method:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(t)};return jQuery.ajax(a)}static showDefaultButton(){jQuery("#paypal-brasil-button-container .paypal-submit-button-bcdc").hide(),jQuery("#paypal-brasil-button-container .paypal-submit-button").hide(),jQuery("#paypal-brasil-button-container .default-submit-button").show()}static showPaypalButton(){jQuery("#paypal-brasil-button-container .default-submit-button").hide(),jQuery("#paypal-brasil-button-container .paypal-submit-button-bcdc").hide(),jQuery("#paypal-brasil-button-container .paypal-submit-button").show()}static showPaypalBCDCButton(){jQuery("#paypal-brasil-button-container .default-submit-button").hide(),jQuery("#paypal-brasil-button-container .paypal-submit-button").hide(),jQuery("#paypal-brasil-button-container .paypal-submit-button-bcdc").show()}static isPaypalPaymentsSelected(){return!!jQuery("#payment_method_paypal-brasil-spb-gateway:checked").length}static isPaypalBCDCPaymentsSelected(){return!!jQuery("#payment_method_paypal-brasil-bcdc-gateway:checked").length}static triggerUpdateCheckout(){jQuery(document.body).trigger("update_checkout")}static triggerUpdateCart(){jQuery(document.body).trigger("wc_update_cart")}static submitForm(){jQuery("form.woocommerce-checkout, form#order_review").submit()}static submitFormCheckout(){jQuery("form.checkout.woocommerce-checkout").submit()}static replaceVars(e,t){let a=e;for(let e in t)t.hasOwnProperty(e)&&(a=a.replace(new RegExp("{"+e+"}","g"),t[e]));return a}}}},t={};function a(r){var n=t[r];if(void 0!==n)return n.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,a),o.exports}a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};(()=>{a.r({});var e=a("./src/frontend/frontend-shared.ts"),t=a("./src/frontend/frontend-bcdc/frontend-bcdc-api.ts"),r=a("./src/frontend/frontend-sdk/frontend-sdk-bcdc.ts"),n=function(e,t,a,r){return new(a||(a=Promise))((function(n,o){function c(e){try{i(r.next(e))}catch(e){o(e)}}function l(e){try{i(r.throw(e))}catch(e){o(e)}}function i(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(c,l)}i((r=r.apply(e,t||[])).next())}))};class o extends e.PaypalPayments{constructor(){super(),this.sdkLoaded=!1,this.updateCheckout=(e=null)=>{e&&e.preventDefault(),this.triggerUpdateCheckout()},this.forceUpdateCheckout=(e=null)=>{e&&e.preventDefault(),jQuery(document.body).trigger("update_checkout")},this.triggerUpdateCheckout=this.debounce((()=>{this.forceUpdateCheckout()}),1e3),paypal_brasil_bcdc_settings.is_order_pay_page?this.initializeOrderPage():this.initializeCheckoutBcdc()}initializeOrderPage(){return n(this,void 0,void 0,(function*(){this.addPaypalBCDCButtonOnContainer(),this.renderPayPalButtonBcdc(),jQuery(document).on("updated_checkout","body",this.addPaypalBCDCButtonOnContainer),jQuery(document).on("updated_checkout","body",this.updateCheckoutButtonBcdc),jQuery("form#order_review").on("change","[name=payment_method],#payment_method_paypal-brasil-bcdc-gateway",this.updateCheckoutButtonBcdc),jQuery("form#order_review").on("change","[name=payment_method],#payment_method_paypal-brasil-bcdc-gateway",this.renderPayPalButtonBcdc),jQuery("form#order_review").on("change","[name=payment_method],#payment_method_paypal-brasil-bcdc-gateway",this.forceUpdateCheckout),this.listenInputChanges(),jQuery(document).on("updated_checkout","body",this.renderPayPalButtonBcdc)}))}initializeCheckoutBcdc(){return n(this,void 0,void 0,(function*(){jQuery(document).on("updated_checkout","body",this.addPaypalBCDCButtonOnContainer),jQuery(document).on("updated_checkout","body",this.updateCheckoutButtonBcdc),jQuery("form.woocommerce-checkout, form#order_review").on("change","[name=payment_method],#payment_method_paypal-brasil-bcdc-gateway",this.updateCheckoutButtonBcdc),jQuery("form.woocommerce-checkout, form#order_review").on("change","[name=payment_method],#payment_method_paypal-brasil-bcdc-gateway",this.renderPayPalButtonBcdc),jQuery("form.woocommerce-checkout, form#order_review").on("change","[name=payment_method],#payment_method_paypal-brasil-bcdc-gateway",this.forceUpdateCheckout),this.listenInputChanges(),jQuery(document).on("updated_checkout","body",this.renderPayPalButtonBcdc)}))}listenInputChanges(){jQuery(["[name=billing_first_name]","[name=billing_last_name]","[name=billing_cpf]","[name=billing_cnpj]","[name=billing_phone]","[name=billing_address_1]","[name=billing_number]","[name=billing_address_2]","[name=billing_neighborhood]","[name=billing_city]","[name=billing_state]","[name=billing_country]","[name=billing_email]"].join(",")).on("keyup",(()=>this.updateCheckout())),jQuery(["[name=billing_persontype]"].join(",")).on("change",(()=>this.updateCheckout()))}addPaypalBCDCButtonOnContainer(){if(!document.querySelector("#paypal-submit-button-bcdc")){var e=document.createElement("div"),t=document.createElement("div");e.className="paypal-submit-button-bcdc",t.id="paypal-button-bcdc";var a=document.querySelector("#paypal-brasil-button-container");a&&(a.appendChild(e),e.appendChild(t))}}updateCheckoutButtonBcdc(){e.PaypalPayments.isPaypalBCDCPaymentsSelected()?(e.PaypalPayments.showPaypalBCDCButton(),console.debug("bcdc change")):e.PaypalPayments.isPaypalPaymentsSelected()||(console.debug("default change"),e.PaypalPayments.showDefaultButton())}renderPayPalButtonBcdc(){return n(this,void 0,void 0,(function*(){var e=document.getElementById("payment_method_paypal-brasil-bcdc-gateway");if(e.checked){yield r.importBcdcSdk.handle();var a=document.getElementById("paypal-button-bcdc");if(a&&paypal_brasil_bcdc_settings.allowed_currency)a.innerHTML="",[paypal.FUNDING.CARD].forEach((e=>n(this,void 0,void 0,(function*(){const a={style:{layout:"vertical",color:"black",shape:"pill",label:"paypal",tagline:"false"},fundingSource:e,expandCardForm:!0,createOrder:()=>{var e,a=null!==(e=jQuery("#wc-bcdc-brasil-data").val())&&void 0!==e?e:null;try{if(a)return a=JSON.parse(a),t.paymentBCDC.create(a)}catch(e){throw e}},onApprove:t.paymentBCDC.approve,onError:t.paymentBCDC.error,onCancel:t.paymentBCDC.cancel},r={style:{layout:"vertical",color:"black",shape:"pill",label:"paypal",tagline:"false"},fundingSource:e,createOrder:()=>{var e,a=null!==(e=jQuery("#wc-bcdc-brasil-data").val())&&void 0!==e?e:null;try{if(a)return a=JSON.parse(a),t.paymentBCDC.create(a)}catch(e){throw e}},onApprove:t.paymentBCDC.approve,onError:t.paymentBCDC.error,onCancel:t.paymentBCDC.cancel},n=paypal.Buttons(a);if(n.isEligible()){n.render("#paypal-button-bcdc");var c=["autoRender:true"];o.sendPaypalLogger("paypal-brasil-bcdc-gateway","Button rendered with Autorender",c)}else{paypal.Buttons(r).render();c=["autoRender:false"];if(o.sendPaypalLogger("paypal-brasil-bcdc-gateway","Button rendered without Autorender",c),paypal.Buttons(r).isEligible()){paypal.Buttons(r).render("#paypal-button-bcdc");c=["autoRender:false"];o.sendPaypalLogger("paypal-brasil-bcdc-gateway","Button rendered without Autorender",c)}}}))))}else e.addEventListener("change",(function(){return n(this,void 0,void 0,(function*(){if(e.checked){yield r.importBcdcSdk.handle();var a=document.getElementById("paypal-button-bcdc");if(a&&paypal_brasil_bcdc_settings.allowed_currency)a.innerHTML="",[paypal.FUNDING.CARD].forEach((e=>n(this,void 0,void 0,(function*(){const a={style:{layout:"vertical",color:"black",shape:"pill",label:"paypal",tagline:"false"},fundingSource:e,expandCardForm:!0,createOrder:()=>{var e,a=null!==(e=jQuery("#wc-bcdc-brasil-data").val())&&void 0!==e?e:null;try{if(a)return a=JSON.parse(a),t.paymentBCDC.create(a)}catch(e){throw e}},onApprove:t.paymentBCDC.approve,onError:t.paymentBCDC.error,onCancel:t.paymentBCDC.cancel},r={style:{layout:"vertical",color:"black",shape:"pill",label:"paypal",tagline:"false"},fundingSource:e,createOrder:()=>{var e,a=null!==(e=jQuery("#wc-bcdc-brasil-data").val())&&void 0!==e?e:null;try{if(a)return a=JSON.parse(a),t.paymentBCDC.create(a)}catch(e){throw e}},onApprove:t.paymentBCDC.approve,onError:t.paymentBCDC.error,onCancel:t.paymentBCDC.cancel},n=paypal.Buttons(a);if(n.isEligible()){n.render("#paypal-button-bcdc");var c=["autoRender:true"];o.sendPaypalLogger("paypal-brasil-bcdc-gateway","Button rendered with Autorender",c)}else{paypal.Buttons(r).render();c=["autoRender:false"];if(o.sendPaypalLogger("paypal-brasil-bcdc-gateway","Button rendered without Autorender",c),paypal.Buttons(r).isEligible()){paypal.Buttons(r).render("#paypal-button-bcdc");c=["autoRender:false"];o.sendPaypalLogger("paypal-brasil-bcdc-gateway","Button rendered without Autorender",c)}}}))))}}))}))}))}static sendPaypalLogger(t,a,r=[],n=[],o="info"){e.PaypalPayments.makeRequest("api_logger_handler",{nonce:paypal_brasil_bcdc_settings.nonce,gateway_id:t,message:a,level:o,tags:r,extra:n})}debounce(e,t,a=!1){let r;return function(){const n=this,o=arguments,c=a&&!r;clearTimeout(r),r=setTimeout((function(){r=null,a||e.apply(n,o)}),t),c&&e.apply(n,o)}}errorHandler(e){}}new o})(),a.r(r)})();
//# sourceMappingURL=frontend-bcdc.js.map