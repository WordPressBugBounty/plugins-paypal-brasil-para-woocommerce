/*! For license information please see frontend-bcdc.js.LICENSE.txt */
(()=>{"use strict";var e={"./src/frontend/frontend-bcdc/frontend-bcdc-api.ts":(e,a,t)=>{t.r(a),t.d(a,{paymentBCDC:()=>n});var r=t("./src/frontend/frontend-shared.ts");const n={create:e=>{if(e.errors&&r.PaypalPayments.isPaypalBCDCPaymentsSelected())throw new Error(e.errors);if(e.payment_id)return e.payment_id;if(r.PaypalPayments.isPaypalBCDCPaymentsSelected())throw new Error("An error occurred in the CREATE_ORDER")},approve:e=>{jQuery("#paypal-bcdc-fields [name=paypal-brasil-bcdc-order-id]").val(e.orderID),jQuery("#paypal-bcdc-fields [name=paypal-brasil-bcdc-payer-id]").val(e.payerID),jQuery("#paypal-bcdc-fields [name=paypal-brasil-bcdc-pay-id]").val(e.paymentID),r.PaypalPayments.submitForm()},error:e=>{const a=jQuery("#wc-bcdc-brasil-api-error-data").val();if(a)r.PaypalPayments.setNotices(JSON.parse(a)),r.PaypalPayments.scrollTop();else{var t='<ul class="woocommerce-error" role="alert"><li>'+e.message+"</li></ul>";r.PaypalPayments.setNotices(t),r.PaypalPayments.scrollTop()}},cancel:()=>{r.PaypalPayments.triggerUpdateCheckout(),r.PaypalPayments.setNotices(paypal_brasil_bcdc_messages.cancel_message),r.PaypalPayments.scrollTop()}}},"./src/frontend/frontend-sdk/frontend-sdk-bcdc.ts":(e,a,t)=>{t.r(a),t.d(a,{importBcdcSdk:()=>n});var r=function(e,a,t,r){return new(t||(t=Promise))((function(n,o){function c(e){try{i(r.next(e))}catch(e){o(e)}}function l(e){try{i(r.throw(e))}catch(e){o(e)}}function i(e){var a;e.done?n(e.value):(a=e.value,a instanceof t?a:new t((function(e){e(a)}))).then(c,l)}i((r=r.apply(e,a||[])).next())}))};const n={handle(){return r(this,void 0,void 0,(function*(){const e=paypal_brasil_bcdc_settings.client_id,a=paypal_brasil_bcdc_settings.currency,t=paypal_brasil_bcdc_settings.locale,r=document.getElementById("paypal-sdk-script"),n=`https://www.paypal.com/sdk/js?client-id=${e}&components=buttons,funding-eligibility,marks,marks&currency=${a}&locale=${t}`;if(r&&r.getAttribute("src")!==n||!r){const e=document.createElement("script");return e.id="paypal-sdk-script",e.async=!0,e.src=n,e.setAttribute("data-page-type","checkout"),document.head.appendChild(e),new Promise(((a,t)=>{e.onload=()=>{a()},e.onerror=e=>{console.error("Erro ao carregar o script do PayPal:",e),a()}}))}return Promise.resolve()}))}}},"./src/frontend/frontend-shared.ts":(e,a,t)=>{t.r(a),t.d(a,{PaypalPayments:()=>r});class r{static scrollTop(){jQuery("html, body").animate({scrollTop:0},300)}static setNotices(e){jQuery(".woocommerce-notices-wrapper:first").html(e)}static makeRequest(e,a){var t,n=null!==(t=paypal_brasil_bcdc_settings.paypal_brasil_handler_url)&&void 0!==t?t:paypal_brasil_settings.paypal_brasil_handler_url;const o={async:!0,crossDomain:!0,url:r.replaceVars(n,{ACTION:e}),method:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(a)};return jQuery.ajax(o)}static showDefaultButton(){jQuery("#paypal-brasil-button-container .paypal-submit-button-bcdc").hide(),jQuery("#paypal-brasil-button-container .paypal-submit-button").hide(),jQuery("#place_order").removeAttr("style"),jQuery("#paypal-brasil-button-container .default-submit-button").show()}static showPaypalButton(){jQuery("#paypal-brasil-button-container .default-submit-button").hide(),jQuery("#paypal-brasil-button-container .paypal-submit-button-bcdc").hide(),jQuery("#place_order").attr("style","display:none !important"),jQuery("#paypal-brasil-button-container .paypal-submit-button").show()}static showPaypalBCDCButton(){jQuery("#paypal-brasil-button-container .default-submit-button").hide(),jQuery("#paypal-brasil-button-container .paypal-submit-button").hide(),jQuery("#place_order").attr("style","display:none !important"),jQuery("#paypal-brasil-button-container .paypal-submit-button-bcdc").show()}static isPaypalPaymentsSelected(){return!!jQuery("#payment_method_paypal-brasil-spb-gateway:checked").length}static isPaypalBCDCPaymentsSelected(){return!!jQuery("#payment_method_paypal-brasil-bcdc-gateway:checked").length}static triggerUpdateCheckout(){jQuery(document.body).trigger("update_checkout")}static triggerUpdateCart(){jQuery(document.body).trigger("wc_update_cart")}static submitForm(){jQuery("form.woocommerce-checkout, form#order_review").submit()}static submitFormCheckout(){jQuery("form.checkout.woocommerce-checkout").submit()}static replaceVars(e,a){let t=e;for(let e in a)a.hasOwnProperty(e)&&(t=t.replace(new RegExp("{"+e+"}","g"),a[e]));return t}}}},a={};function t(r){var n=a[r];if(void 0!==n)return n.exports;var o=a[r]={exports:{}};return e[r](o,o.exports,t),o.exports}t.d=(e,a)=>{for(var r in a)t.o(a,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:a[r]})},t.o=(e,a)=>Object.prototype.hasOwnProperty.call(e,a),t.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};(()=>{t.r({});var e=t("./src/frontend/frontend-shared.ts"),a=t("./src/frontend/frontend-bcdc/frontend-bcdc-api.ts"),r=t("./src/frontend/frontend-sdk/frontend-sdk-bcdc.ts"),n=function(e,a,t,r){return new(t||(t=Promise))((function(n,o){function c(e){try{i(r.next(e))}catch(e){o(e)}}function l(e){try{i(r.throw(e))}catch(e){o(e)}}function i(e){var a;e.done?n(e.value):(a=e.value,a instanceof t?a:new t((function(e){e(a)}))).then(c,l)}i((r=r.apply(e,a||[])).next())}))};class o extends e.PaypalPayments{constructor(){super(),this.sdkLoaded=!1,this.clearCheckoutErrors=()=>{jQuery(".woocommerce-error, .woocommerce-message, .woocommerce-info").fadeOut(300,(function(){jQuery(this).remove()}))},this.updateCheckout=(e=null)=>{e&&e.preventDefault(),this.triggerUpdateCheckout()},this.forceUpdateCheckout=(e=null)=>{e&&e.preventDefault(),jQuery(document.body).trigger("update_checkout")},this.triggerUpdateCheckout=this.debounce((()=>{this.forceUpdateCheckout()}),1e3),paypal_brasil_bcdc_settings.is_order_pay_page?this.initializeOrderPage():this.initializeCheckoutBcdc()}initializeOrderPage(){return n(this,void 0,void 0,(function*(){this.addPaypalBCDCButtonOnContainer(),this.renderPayPalButtonBcdc(),jQuery(document).on("updated_checkout","body",this.addPaypalBCDCButtonOnContainer),jQuery(document).on("updated_checkout","body",this.updateCheckoutButtonBcdc),jQuery("form#order_review").on("change","[name=payment_method],#payment_method_paypal-brasil-bcdc-gateway",this.updateCheckoutButtonBcdc),jQuery("form#order_review").on("change","[name=payment_method],#payment_method_paypal-brasil-bcdc-gateway",this.renderPayPalButtonBcdc),jQuery("form#order_review").on("change","[name=payment_method],#payment_method_paypal-brasil-bcdc-gateway",this.forceUpdateCheckout),this.listenInputChanges(),jQuery(document).on("updated_checkout","body",this.renderPayPalButtonBcdc)}))}initializeCheckoutBcdc(){return n(this,void 0,void 0,(function*(){jQuery(document).on("updated_checkout","body",this.addPaypalBCDCButtonOnContainer),jQuery(document).on("updated_checkout","body",this.updateCheckoutButtonBcdc),jQuery("form.woocommerce-checkout, form#order_review").on("change","[name=payment_method],#payment_method_paypal-brasil-bcdc-gateway",this.updateCheckoutButtonBcdc),jQuery("form.woocommerce-checkout, form#order_review").on("change","[name=payment_method],#payment_method_paypal-brasil-bcdc-gateway",this.renderPayPalButtonBcdc),jQuery("form.woocommerce-checkout, form#order_review").on("change","[name=payment_method],#payment_method_paypal-brasil-bcdc-gateway",this.forceUpdateCheckout),this.listenInputChanges(),jQuery(document).on("updated_checkout","body",this.renderPayPalButtonBcdc),jQuery(document).on("updated_checkout","body",this.clearCheckoutErrors)}))}listenInputChanges(){jQuery(["[name=billing_first_name]","[name=billing_last_name]","[name=billing_cpf]","[name=billing_cnpj]","[name=billing_phone]","[name=billing_address_1]","[name=billing_number]","[name=billing_address_2]","[name=billing_neighborhood]","[name=billing_city]","[name=billing_state]","[name=billing_country]","[name=billing_email]"].join(",")).on("keyup",(()=>{e.PaypalPayments.isPaypalBCDCPaymentsSelected()&&this.updateCheckout()})),jQuery(["[name=billing_persontype]"].join(",")).on("change",(()=>{e.PaypalPayments.isPaypalBCDCPaymentsSelected()&&this.updateCheckout()}))}addPaypalBCDCButtonOnContainer(){if(!document.querySelector("#paypal-submit-button-bcdc")){var e=document.createElement("div"),a=document.createElement("div");e.className="paypal-submit-button-bcdc",a.id="paypal-button-bcdc";var t=document.querySelector("#paypal-brasil-button-container");t&&(t.appendChild(e),e.appendChild(a))}}updateCheckoutButtonBcdc(){if(e.PaypalPayments.isPaypalBCDCPaymentsSelected()){var a=jQuery("#wc-bcdc-brasil-selected");a&&a.val("true"),e.PaypalPayments.showPaypalBCDCButton(),console.debug("bcdc change")}else e.PaypalPayments.isPaypalPaymentsSelected()||((a=jQuery("#wc-bcdc-brasil-selected"))&&a.val("false"),this.clearCheckoutErrors,e.PaypalPayments.showDefaultButton())}renderPayPalButtonBcdc(){return n(this,void 0,void 0,(function*(){var t=document.getElementById("payment_method_paypal-brasil-bcdc-gateway");if(t.checked){jQuery("#wc-bcdc-brasil-selected").val("true"),yield r.importBcdcSdk.handle();var c=document.getElementById("paypal-button-bcdc");if(c&&paypal_brasil_bcdc_settings.allowed_currency)c.innerHTML="",[paypal.FUNDING.CARD].forEach((t=>n(this,void 0,void 0,(function*(){const r={style:{layout:"vertical",color:"black",shape:"pill",label:"paypal",tagline:"false"},fundingSource:t,expandCardForm:!!e.PaypalPayments.isPaypalBCDCPaymentsSelected(),createOrder:()=>{var t,r=null!==(t=jQuery("#wc-bcdc-brasil-data").val())&&void 0!==t?t:null;try{if(r)return r=JSON.parse(r),a.paymentBCDC.create(r)}catch(a){if(e.PaypalPayments.isPaypalBCDCPaymentsSelected())throw a;this.clearCheckoutErrors()}},onApprove:a.paymentBCDC.approve,onError:a.paymentBCDC.error,onCancel:a.paymentBCDC.cancel},n={style:{layout:"vertical",color:"black",shape:"pill",label:"paypal",tagline:"false"},fundingSource:t,createOrder:()=>{var e,t=null!==(e=jQuery("#wc-bcdc-brasil-data").val())&&void 0!==e?e:null;try{if(t)return t=JSON.parse(t),a.paymentBCDC.create(t)}catch(e){throw e}},onApprove:a.paymentBCDC.approve,onError:a.paymentBCDC.error,onCancel:a.paymentBCDC.cancel},c=paypal.Buttons(r);if(c.isEligible()){c.render("#paypal-button-bcdc");var l=["autoRender:true"];o.sendPaypalLogger("paypal-brasil-bcdc-gateway","Button rendered with Autorender",l)}else{paypal.Buttons(n).render();l=["autoRender:false"];if(o.sendPaypalLogger("paypal-brasil-bcdc-gateway","Button rendered without Autorender",l),paypal.Buttons(n).isEligible()){paypal.Buttons(n).render("#paypal-button-bcdc");l=["autoRender:false"];o.sendPaypalLogger("paypal-brasil-bcdc-gateway","Button rendered without Autorender",l)}}}))))}else jQuery("#wc-bcdc-brasil-selected").val("false"),t.addEventListener("change",(function(){return n(this,void 0,void 0,(function*(){if(t.checked){jQuery("#wc-bcdc-brasil-selected").val("true"),yield r.importBcdcSdk.handle();var c=document.getElementById("paypal-button-bcdc");if(c&&paypal_brasil_bcdc_settings.allowed_currency)c.innerHTML="",[paypal.FUNDING.CARD].forEach((t=>n(this,void 0,void 0,(function*(){const r={style:{layout:"vertical",color:"black",shape:"pill",label:"paypal",tagline:"false"},fundingSource:t,expandCardForm:!!e.PaypalPayments.isPaypalBCDCPaymentsSelected(),createOrder:()=>{var t,r=null!==(t=jQuery("#wc-bcdc-brasil-data").val())&&void 0!==t?t:null;try{if(r)return r=JSON.parse(r),a.paymentBCDC.create(r)}catch(a){if(e.PaypalPayments.isPaypalBCDCPaymentsSelected())throw a;jQuery(".woocommerce-error, .woocommerce-message, .woocommerce-info").fadeOut(300,(function(){jQuery(this).remove()}))}},onApprove:a.paymentBCDC.approve,onError:a.paymentBCDC.error,onCancel:a.paymentBCDC.cancel},n={style:{layout:"vertical",color:"black",shape:"pill",label:"paypal",tagline:"false"},fundingSource:t,createOrder:()=>{var t,r=null!==(t=jQuery("#wc-bcdc-brasil-data").val())&&void 0!==t?t:null;try{if(r)return r=JSON.parse(r),a.paymentBCDC.create(r)}catch(a){if(e.PaypalPayments.isPaypalBCDCPaymentsSelected())throw a}},onApprove:a.paymentBCDC.approve,onError:a.paymentBCDC.error,onCancel:a.paymentBCDC.cancel},c=paypal.Buttons(r);if(c.isEligible()){c.render("#paypal-button-bcdc");var l=["autoRender:true"];o.sendPaypalLogger("paypal-brasil-bcdc-gateway","Button rendered with Autorender",l)}else{paypal.Buttons(n).render();l=["autoRender:false"];if(o.sendPaypalLogger("paypal-brasil-bcdc-gateway","Button rendered without Autorender",l),paypal.Buttons(n).isEligible()){paypal.Buttons(n).render("#paypal-button-bcdc");l=["autoRender:false"];o.sendPaypalLogger("paypal-brasil-bcdc-gateway","Button rendered without Autorender",l)}}}))))}}))}))}))}static sendPaypalLogger(a,t,r=[],n=[],o="info"){e.PaypalPayments.makeRequest("api_logger_handler",{nonce:paypal_brasil_bcdc_settings.nonce,gateway_id:a,message:t,level:o,tags:r,extra:n})}debounce(e,a,t=!1){let r;return function(){const n=this,o=arguments,c=t&&!r;clearTimeout(r),r=setTimeout((function(){r=null,t||e.apply(n,o)}),a),c&&e.apply(n,o)}}}new o})(),t.r(r)})();
//# sourceMappingURL=frontend-bcdc.js.map